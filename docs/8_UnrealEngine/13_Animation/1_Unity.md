# Unityでのアニメーション設定

## 1. 基本用語と概念の詳細説明
- **ボーン（Bone）**:   
  - 3Dキャラクターモデルの内部構造。  
  ボーンは階層構造を持ち、親子関係で繋がっています。  
  例えば、腕のボーンは肩のボーンの子供であり、手のボーンは腕のボーンの子供です。

- **スキンメッシュ（Skinned Mesh）**:   
  - ボーンに付随する3Dモデル。  
  ボーンの動きに応じてメッシュが変形します。  
  これにより、キャラクターの動きを自然に見せることができます。

- **リギング（Rigging）**:   
  - モデルにボーンを配置し、ボーンとメッシュを連動させるプロセス。  
  リギングにより、キャラクターのアニメーションを実現するための骨格が作られます。

- **ウェイトペインティング（Weight Painting）**:   
  - 各頂点がどのボーンにどれだけ影響されるかを指定する作業。  
  これにより、ボーンの動きに対するメッシュの変形がスムーズになります。

<br>

## 2. Unityでの具体的な手順

### モデルのインポート
1. **FBXファイルの準備**:   
   - 3Dモデリングソフト（Blender、Mayaなど）でボーンとスキンメッシュを設定したモデルをFBX形式でエクスポートします。  
   そのほか、Mixamoなどを利用してもいいと思います。  
   （この記事を閲覧している頃はAIで自動でモデルやアニメーションを生成してくれるいろんなアプリが出ているでしょうね。）
2. **Unityにインポート**:   
   - UnityプロジェクトのアセットフォルダにFBXファイルをドラッグ＆ドロップします。

### リギングの設定
1. **インポート設定**:
   - インポートしたFBXファイルを選択し、インスペクターウィンドウで「Rig」タブを選択します。
   - Animation Typeを「Humanoid」または「Generic」に設定します（通常はHumanoidが推奨されます）。
   - 必要に応じて、アバターを設定します（自動設定も可能です）。
2. **アニメーターコンポーネントの追加**:
   - モデルをシーンに配置し、インスペクターウィンドウで「Add Component」をクリックし、「Animator」コンポーネントを追加します。
   - 「Animator」コンポーネントのControllerフィールドに「Animator Controller」を設定します。

### アニメーションの作成
そのほか、Mixamo・ Cascadeurなどを利用してもいいと思います。  
（この記事を閲覧している頃はAIで自動でモデルやアニメーションを生成してくれるいろんなアプリが出ているでしょうね。）
1. **アニメーションクリップのインポート**:   
   - インポートしたFBXファイルに含まれるアニメーションクリップを確認し、必要に応じてクリップの設定を変更します（例：ループ設定など）。
2. **アニメーションクリップの作成**:
   - **Animationウィンドウ**を開き、モデルを選択して新しいアニメーションクリップを作成します。
   - **Animationウィンドウ**でキーを打ち、ボーンの動きを記録します。

### アニメーションの制御
1. **アニメーターコントローラーの作成**:
   - プロジェクトウィンドウで右クリックし、「Create」->「Animator Controller」を選択します。
   - 作成したアニメーターコントローラーを開き、ステートマシンにアニメーションクリップをドラッグ＆ドロップします。
2. **アニメーションの遷移設定**:
   - ステートマシン内でアニメーションステートを選択し、遷移条件を設定します（例：ボタン入力、パラメータ変更など）。

<br>

## 3. Unityでの実践例

以下に、Unityでキャラクターアニメーションを設定するためのサンプルコードを示します。

```csharp
using UnityEngine;

public class CharacterAnimationController : MonoBehaviour
{
    private Animator animator;

    void Start()
    {
        animator = GetComponent<Animator>();
    }

    void Update()
    {
        if (Input.GetKeyDown(KeyCode.W))
        {
            animator.SetBool("isWalking", true);
        }
        else if (Input.GetKeyUp(KeyCode.W))
        {
            animator.SetBool("isWalking", false);
        }

        if (Input.GetKeyDown(KeyCode.Space))
        {
            animator.SetTrigger("Jump");
        }
    }
}
```

このスクリプトは、キャラクターが「W」キーを押したときに歩行アニメーションを開始し、キーを離したときに停止します。また、スペースキーを押したときにジャンプアニメーションをトリガーします。

<br>

## 4. トラブルシューティング

- **モデルが正しく動かない**:   
ウェイトペインティングが正しく設定されているか確認します。また、ボーンの階層構造が正しいかもチェックします。

- **アニメーションが滑らかでない**:   
アニメーションクリップのキーの打ち方や、遷移設定が適切であるか確認します。



