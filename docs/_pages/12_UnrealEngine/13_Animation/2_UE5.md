# Unreal Engine 5（UE5）でのアニメーション設定

## 1. 基本用語と概念の詳細説明
- **スケルトンメッシュ（Skeletal Mesh）**:   
  - ボーン（スケルトン）に関連付けられた3Dモデル。  
  スケルトンの動きに応じてメッシュが変形します。  
  キャラクターや動物など、複雑なアニメーションを必要とするオブジェクトに使用されます。

- **スケルトン（Skeleton）**:   
  - ボーンの階層構造。  
  各ボーンは他のボーンと親子関係を持ち、スケルトン全体としてキャラクターの骨格を形成します。

- **アニメーションブループリント（Animation Blueprint）**:      
  - スケルトンメッシュのアニメーションを制御するためのビジュアルスクリプティングツール。  
  アニメーションの遷移やロジックを設定するために使用されます。

- **リギング（Rigging）**:   
  - モデルにボーンを配置し、ボーンとメッシュを連動させるプロセス。  
  キャラクターのアニメーションの基本骨格を作成します。

- **ウェイトペインティング（Weight Painting）**:   
  - 各頂点がどのボーンにどれだけ影響されるかを指定する作業。  
  これにより、ボーンの動きに対するメッシュの変形がスムーズになります。

<br>

## 2. UE5での具体的な手順

### モデルのインポート
1. **FBXファイルの準備**:   
   - 3Dモデリングソフト（Blender、Mayaなど）でボーンとスキンメッシュを設定したモデルをFBX形式でエクスポートします。
   MixiamoとそのConverterなども使用していいと思います。
2. **UE5にインポート**:
   - **Content Browser**で右クリックし、「Import」を選択してFBXファイルをインポートします。
   - インポート設定で、スケルトンを新規作成するか、既存のスケルトンを使用するかを選択します。

<br>

### リギングの設定
1. **スケルトンメッシュの確認**:
   - インポートしたスケルトンメッシュをダブルクリックして開き、**Skeleton Tree**でボーンの階層構造を確認します。
2. **ウェイトペインティングの確認**:
   - **Personaアニメーションエディタ**でスケルトンメッシュを開き、**Weight Paint**モードで各頂点のウェイトを確認・調整します。

<br>

### アニメーションの作成
1. **アニメーションクリップのインポート**:
   - FBXファイルに含まれるアニメーションクリップをインポートし、**Content Browser**で確認します。
2. **アニメーションブループリントの作成**:
   - **Content Browser**で右クリックし、「Animation」->「Animation Blueprint」を選択して新しいブループリントを作成します。
   - **Skeleton**フィールドに、インポートしたスケルトンを指定します。

<br>

### アニメーションの制御
1. **アニメーションブループリントの設定**:
   - アニメーションブループリントをダブルクリックして開き、**Event Graph**でアニメーションの遷移ロジックを設定します。
   - **AnimGraph**でアニメーションの遷移を視覚的に設定し、ステートマシンを構築します。
2. **アニメーションステートの設定**:
   - **AnimGraph**でステートを追加し、インポートしたアニメーションクリップを割り当てます。
   - ステート間の遷移条件を設定し、遷移のスムーズさを調整します。

<br>

## 3. UE5での実践例

以下に、UE5でキャラクターアニメーションを設定するための基本的な手順とサンプルコードを示します。

### アニメーションブループリントの設定例
1. **アニメーションブループリントのイベントグラフ**:
   - プレイヤー入力に基づいてアニメーションを制御するためのノードを追加します。

```cpp
// キャラクターのスクリプトでアニメーションブループリントのパラメータを設定
void AMyCharacter::Tick(float DeltaTime)
{
    Super::Tick(DeltaTime);

    // 移動速度を取得
    float Speed = GetVelocity().Size();

    // アニメーションブループリントに移動速度を設定
    UAnimInstance* AnimInstance = GetMesh()->GetAnimInstance();
    if (AnimInstance)
    {
        AnimInstance->SetFloatParameter("Speed", Speed);
    }
}
```

<br>

### アニメーションブループリントのアニメグラフ設定例
1. **アニメグラフでステートマシンを設定**:
   - Idle、Walk、Runなどのステートを作成し、それぞれにアニメーションクリップを割り当てます。
   - ステート間の遷移条件を設定し、スムーズな遷移を実現します。

<br>

## 4. トラブルシューティング

- **モデルが正しく動かない**:   
スケルトン構造やウェイトペインティングが正しく設定されているか確認します。特に、ボーンの階層が期待通りに配置されているかを確認します。
- **アニメーションが滑らかでない**: アニメーションクリップのキー設定や遷移設定が適切であるか確認します。遷移のスムーズさを調整することで、より自然なアニメーションが可能です。

